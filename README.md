# jikken3

## 走行モードの選択

`leader/leader.ino` では、往復走行・周回走行・端点Uターン走行を切り替えられる `RunMode` を用意しています。

1. **コンパイル時既定値**: `COMPILE_TIME_RUNMODE` を `RUNMODE_RECIP`（往復）、`RUNMODE_LOOP`（周回）、`RUNMODE_UTURN`（端点でその場Uターン）から選択します。
2. **DIP スイッチ**: `RUNMODE_DIP_PIN` を任意の入力ピン番号に変更すると、起動時にそのスイッチの状態でモードを決定できます（既定では ON=周回、OFF=往復です。必要に応じて定数を書き換えて U ターンモードを割り当ててください）。
3. **シリアルコマンド**: `setup()` 内で 3 秒間、シリアルモニタから `recip` / `loop` / `uturn` を送るとモードを上書きできます。

起動時には選択されたモードがシリアルログに表示されるため、オペレータは現在の走行方針を確認できます。

## センサ優勢時の挙動について

ライン追従では、右センサがより黒を検出したとき `computeError` が正となり、前進時は左車輪が速く・右車輪が遅くなる補正をかけて機体が右へ寄るよう制御しています。一方で後退やリカバリーでは左右の符号が反転するため、左車輪の後退量が大きく（角速度は左旋回）なりながらも、機体は後退軌道で右へ弧を描いてラインへ復帰します。センサ優勢と旋回方向の直感が一致しなくても、最終的な軌道は右センサ優勢なら右へ、左センサ優勢なら左へ寄る設計になっています。
